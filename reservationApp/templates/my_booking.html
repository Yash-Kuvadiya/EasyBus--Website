{% load customfilter %} {% load humanize %} 
<style>
    #uni_modal .modal-footer {
        display: none;
    }
    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .text-center {
        text-align: center;
    }
    .no-booking-Text {
        font-size: 16px;
        line-height: 1.5;
        margin: 0;
        background-color: #b1d8de;
        color: #333;
        padding: 13px;
    }
    a {
        color: #428bca;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.2s ease-in-out;
    }
    a:hover {
        color: #2a6496;
    }
    .ticket-container {
        background-color: #b1d8de;
        width: 200px;
        padding-bottom: 15px;
        border: 1px solid black;
        border-radius: 10px;
    }
    #secondry-container {
        background-color: #428bca;
        padding: 20px;
        border-radius: 10px;
    }
    #container-main {
        width: 500px;
        border: 1px solid black;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        margin-top: 25px;
    }
    #heading-row {
        border-bottom: 1px solid black;
        padding: 5px;
        color: rgb(69, 78, 245);
    }
    #btn-close, #btn-cancel {
        margin: 5px;
        margin-bottom: 10px;
        background-color: #3225e2;
        color: #ffffff;
        border-radius: 5px;
    }
    #btn-cancel {
        background-color: #d9534f; /* Red color for cancel button */
    }
</style>

{% if all_bookings is not None %}
{% for booking in all_bookings %}
<div class="container-fluid" id="container-main">
    <div class="row" id="heading-row">
        <b><center>Booked Ticket</center></b>
    </div>
    <div class="row">
        <div class="col-12 p-2">
            <b>Booked By : </b>{{ booking.name }}
        </div>
    </div>
    <div class="row">
        <div class="col-4 p-2">
            <b>Bus Number : </b> {{ booking.schedule.bus }}
        </div>
        <div class="col-1">
            <!-- space -->
        </div>
        <div class="col-7 p-2">
            <b>Schedule Code : </b> {{ booking.code }}
        </div>
    </div>
    <div class="row">
        <div class="col-12 p-2">
            <b>Trip Schedule : </b> {{ booking.schedule.schedule|date:"M d, Y h:i A" }}
        </div>
    </div>
    <div class="column">
        <div class="row">
            <div class="col-12 p-2">
                <b>Seats </b>(Total Seats : {{ booking.seats }}) : {% for seat in booking.book_seats.all %}
                {{ seat.seat_number }},
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 p-2">
            <b>Total Cost : </b> {{ booking.total_payable|intcomma }}
        </div>
    </div>
    <div class="row">
        <div class="col-12 p-2">
            <center>
                <button class="btn btn-default border bg-gradient rounded-0 btn-sm" type="button" data-bs-dismiss="modal" onclick="location.href='{% url 'home-page' %}'" id="btn-close">Go To Home</button>
                <!-- <button class="btn btn-default border bg-gradient rounded-0 btn-sm" type="button" id="btn-cancel" onclick="cancelBooking('{{ booking.pk }}')">Cancel Booking</button> -->
                <button class="delete-booking" data-id="{{ booking.id }}">Delete</button>
            </center>
        </div>
    </div>
    <div class="clear-fix py-3"></div>
    <div class="text-end">
        {% if booking.status == '1' %}
        <button class="btn btn-success border-succes bg-gradient rounded-0 btn-sm" type="button" id="paid">Mark as Paid</button> {% endif %}
    </div>
</div>
{% endfor %}
{% else %}
<div class="container centered">
    <div class="text-center">
        <p class="no-booking-Text">You have No bookings, Click <a href="{% url 'find-trip-page' %}">here</a> to find a trip OR click <a href="{% url 'scheduled-trips-page' %}">here</a> to see the scheduled trips.</p>
    </div>
</div>
{% endif %}

<!-- links of bootstrap online "CDN" -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<!-- Add this button/link wherever you want in your my_booking.html template -->



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.delete-booking').click(function() {
            var bookingId = $(this).data('id');
            var confirmation = confirm('Are you sure you want to delete this booking?');
            if (confirmation) {
                $.ajax({
                    url: '{% url "delete_booking" %}',
                    type: 'POST',
                    data: {
                        'id': bookingId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            alert('Booking deleted successfully');
                            // Enable the seats associated with the deleted booking
                            $('input[name="all_seats"]:disabled').each(function() {
                                var seatNumber = $(this).val();
                                // Assuming seatNumber corresponds to the seat ID
                                $(this).prop('disabled', false).prop('checked', false);
                            });
                            location.reload(); // Reload the page to update the list
                        } else {
                            alert('Failed to delete booking');
                        }
                    }
                });
            }
        });
    });
</script>